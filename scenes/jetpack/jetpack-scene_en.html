<link rel="import" href="../base-scene.html">

<script src="../shared/js/startbutton.js"></script>
<script src="jetpack-scene.min.js"></script>

<!--
Jetpack scene.

@element jetpack-scene
@extends base-scene
-->
<polymer-element name="jetpack-scene" extends="base-scene">
<template>
  <link rel="stylesheet" href="jetpack-scene.css" no-shim>

  <div id="module-jetpack">
    <div class="background background--0"></div>
    <div class="background background--1"></div>
    <div class="goal"></div>
    <div class="scene">
      <div class="clouds"></div>
      <div class="items"></div>
      <div class="player">
        <div class="player-overlay"></div>
        <div class="fire">
          <div class="fire-orange"></div>
          <div class="fire-yellow"></div>
        </div>
        <div class="sparkles">
          <div class="sparkle"></div>
          <div class="sparkle"></div>
          <div class="sparkle"></div>
          <div class="sparkle"></div>
          <div class="sparkle"></div>
          <div class="sparkle"></div>
          <div class="sparkle"></div>
        </div>
      </div>
    </div>
    <div class="touchpad hidden">
      <div class="touchpad-nub"></div>
    </div>
    <div class="gui">
      <div class="board board--game"><a id="global-back-to-village" href="{{pageUrl}}#village" class="back">
          <i18n-msg msgid="gotovillage">PLACEHOLDER_i18n</i18n-msg></a>
        <div class="logo"></div>
        <div class="score">
          <div class="label">
            <i18n-msg msgid="score">PLACEHOLDER_i18n</i18n-msg>
          </div>
          <div class="value">0</div>
        </div>
        <div class="level has-count">
          <div class="label">
            <i18n-msg msgid="level">PLACEHOLDER_i18n</i18n-msg>
          </div>
          <div class="value"><span class="current-level">1</span><span class="dark-text">/10</span>
          </div>
          <div class="level-dots">
            <template repeat="{{i in [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}}">
              <div class="level-item{{i === 1 ? ' is-active' : ''}}">
                <div class="level-dot"></div>
                <div class="level-shadow"></div>
                <div class="level-number">{{i}}</div>
              </div>
            </template>
          </div>
        </div>
        <div class="time">
          <div class="label">
            <i18n-msg msgid="time">PLACEHOLDER_i18n</i18n-msg>
          </div>
          <div class="value"><span class="minutes dark-text">00</span><span class="dark-text"> : </span><span class="seconds">00</span></div>
          <div class="tracker">
            <div class="remaining"></div>
          </div>
          <div class="status"></div>
        </div>
        <div class="actions {{ {'is-collapsed': !hasClickedStart} | tokenList }}">
          <button type="button" class="restart"></button>
          <button type="button" class="pause"></button>
        </div>
      </div>
      <div class="gameover overlay">
        <div class="gameover-dialog overlay-dialog">
          <h2 class="gameover-title">
            <i18n-msg msgid="gameover">PLACEHOLDER_i18n</i18n-msg>
          </h2>
          <div class="gameover-winner">
            <div class="gameover-level">
              <p class="gameover-label">
                <i18n-msg msgid="gameover_level">PLACEHOLDER_i18n</i18n-msg>
              </p>
              <p class="gameover-number">0</p>
            </div>
            <div class="gameover-score">
              <p class="gameover-label">
                <i18n-msg msgid="gameover_score">PLACEHOLDER_i18n</i18n-msg>
              </p>
              <p class="gameover-number">0</p>
            </div>
          </div>
          <div class="gameover-buttons">
            <button type="button" class="Button Button--large gameover-play">
              <i18n-msg msgid="playagain">PLACEHOLDER_i18n</i18n-msg>
            </button>
            <a href="{{pageUrl}}#village" class="Button Button--large"><i18n-msg msgid="gotovillage">PLACEHOLDER_i18n</i18n-msg></a>
            <div class="shareButtons"><a href="javascript:;" target="_blank" class="Button Button--small Button--noText shareButtons-google">Google+</a><a href="javascript:;" target="_blank" class="Button Button--small Button--noText shareButtons-facebook">Facebook</a><a href="javascript:;" target="_blank" class="Button Button--small Button--noText shareButtons-twitter">Twitter</a></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</template>
<script>
(function() {
  Polymer({
    componentDir: 'scenes/jetpack/',

    game: null,

    hasClickedStart: false,

    onPreload: function() {
      this.preloadSounds('jp_load_sounds', 30);
      this.preloadImages([
        'img/cloud.png',
        'img/fire.png',
        'img/items.png',
        'img/logo.svg',
        'img/player.png',
        'img/touchpad.png',
        'img/player-hit.svg',
        'img/player-overlay.svg',
        'img/clock.png',
        'img/danger.png',
        'img/levelclouds.svg'
      ]);
    },

    onShow: function() {
      var module = this.$['module-jetpack'];

      this.game = new scenes.jetpack.Game(module);
      startButton(this, module, this.onClickStart_.bind(this));
    },

    onHide: function() {
      this.game.dispose();
      this.game = null;
      this.fire('sound-ambient', 'jp_end_game');
    },

    onClickStart_: function() {
      this.hasClickedStart = true;
      this.game.start();
    }
  });

})();
</script>
</polymer-element>